var Util={bling:void 0,isBlinging:!1,ipAction:function(e){switch(e){case 1:$("#ipType").val("ban");break;case 2:$("#ipType").val("unban")}$("#ipListForm").submit()},insertWarnBroadcastModel:function(e){let t="";switch(e){case 1:t="摸鱼派社区即将进行升级维护，预计停服时间：<b>5分钟</b><br>维护完成后摸鱼派将自动刷新（客户端请手动重新登录），感谢你的理解～<br>摸鱼这么久了，去给自己倒杯咖啡吧 ☕️";break;case 2:t="摸鱼派社区即将进行升级维护，预计停服时间：<b>20秒</b><br>维护完成后摸鱼派将自动刷新（客户端请手动重新登录），感谢你的理解～<br>摸鱼这么久了，去给自己倒杯咖啡吧 ☕️"}$("[name='warnBroadcastText']").val(t)},genMetal(e,t){return"https://fishpi.cn/gen?scale=0.79&txt="+e+(t=void 0!==t&&""!==t?"&"+t:"")},genMiniMetal(e){return"https://fishpi.cn/gen?scale=0.79&txt="+(e=void 0!==e&&""!==e?"&"+e:"")},parseDom(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes},parseArray(arrStr){var tempKey="arr23"+(new Date).getTime(),arrayJsonStr='{"'+tempKey+'":'+arrStr+"}",arrayJson,arrayJson=JSON&&JSON.parse?JSON.parse(arrayJsonStr):eval("("+arrayJsonStr+")");return arrayJson[tempKey]},fadeIn(t,a){let i=0;for(let e=0;e<100;e++)setTimeout(function(){i=+(i+.01).toFixed(2),t.style.opacity=i,99===e&&setTimeout(a,200)},5*e)},fadeOut(t,a){let i=1;for(let e=0;e<100;e++)setTimeout(function(){i=+(i-.01).toFixed(2),t.style.opacity=i,99===e&&setTimeout(a,400)},5*e)},getAtUsers:function(e){var a=[];return $.ajax({url:Label.servePath+"/users/names",type:"POST",async:!1,data:JSON.stringify({name:e}),success:function(e){if(0===e.code)for(var t=0;t<e.data.length;t++)a.push({value:"@"+e.data[t].userName+" ",html:'<img src="'+e.data[t].userAvatarURL48+'"/>'+e.data[t].userName,avatar:e.data[t].userAvatarURL48,username:e.data[t].userName});else alert(e.msg)}}),a},LazyLoadImage:function(){function t(e){var t=document.createElement("img");t.src=e.getAttribute("data-src"),t.addEventListener("load",function(){$(e).attr("style")||$(e).attr("class")||$(e).attr("width")||$(e).attr("height")||1!==$(e).closest(".vditor-reset").length||t.naturalHeight>t.naturalWidth&&t.naturalWidth/t.naturalHeight<$(e).closest(".vditor-reset").width()/($(window).height()-40)&&t.naturalHeight>$(window).height()-40&&(e.style.height=$(window).height()-40+"px"),$(e).attr("class")||1!==$(e).closest(".vditor-reset").length||_processPreview($(e)),e.src=t.src,e.style.backgroundImage="none",e.style.backgroundColor="transparent"}),e.removeAttribute("data-src")}if(!("IntersectionObserver"in window))return $("img").each(function(){this.getAttribute("data-src")&&t(this)}),!1;window.imageIntersectionObserver?window.imageIntersectionObserver.disconnect():window.imageIntersectionObserver=new IntersectionObserver(function(e){e.forEach(function(e){(void 0===e.isIntersecting?0!==e.intersectionRatio:e.isIntersecting)&&e.target.getAttribute("data-src")&&t(e.target)})}),$("img").each(function(){window.imageIntersectionObserver.observe(this)})},addStyle:function(e,t){var a;document.getElementById(t)||((a=document.createElement("link")).id=t,a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(a))},parseHljs:function(){Vditor.highlightRender({style:"github",enable:!Label.luteAvailable},document)},parseMarkdown:function(){Vditor.mermaidRender(document.body),Vditor.flowchartRender(document.body),Vditor.chartRender(),Vditor.mindmapRender(),Vditor.mathRender(document.body),Vditor.codeRender(document.body,Label.langLabel),Vditor.abcRender(),Vditor.graphvizRender(document.body),Vditor.plantumlRender(document.body);var e,t=!1;$(".vditor-reset").each(function(){$(this).find("a").each(function(){var e=$(this).attr("href");e&&".mov"===e.substr(e.length-4).toLowerCase()&&(t=!0)})}),t&&(e=function(){$(".vditor-reset").each(function(){$(this).find("a").each(function(){var e=$(this),t=$(this).attr("href");t&&".mov"===t.substr(t.length-4).toLowerCase()&&(this.style.height="360px",this.style.width="270px",e.removeAttr("href"),(e=LivePhotosKit.Player(this)).photoSrc=Label.staticServePath+"/images/livephoto.png",e.videoSrc=t)})})},"undefined"!=typeof LivePhotosKit?e():$.ajax({method:"GET",url:Label.staticServePath+"/js/lib/livephotoskit.js",dataType:"script",cache:!0}).done(function(){e()}))},prevKey:void 0,clipboard:function(e,t,a){e.click(function(e){t[0].select();try{document.execCommand("copy")?a():console.log("Copy command was unsuccessful")}catch(e){console.log("Oops, unable to copy")}window.getSelection().removeAllRanges()})},closeAlert:function(){$(document).mouseup(function(){$("body").css("overflow",""),$(document).off("mousemove")}).on("touchend",function(e){$("body").css("overflow",""),$(document).off("touchmove")}),$("#alertDialogPanel,.dialog-background").fadeOut(200),setTimeout(function(){$("#alertDialogPanel,.dialog-background").remove()},200)},clearAlert(){$("#alertDialogPanel,.dialog-background").remove()},alert:function(e,t=""){var o;function a(e){var t=$(o).offset();const i=(e=e.pageX?e:e.targetTouches[0]).pageX-t.left,n=e.pageY-t.top;function a(e){$("body").css("overflow","hidden");let t=(e=e.pageX?e:e.targetTouches[0]).pageX-i,a=e.pageY-n-$(window).scrollTop();t<0?t=0:t>$(document).width()-$(o).outerWidth(!0)&&(t=$(document).width()-$(o).outerWidth(!0)),a<0?a=0:a>$(document).height()-$(o).outerHeight(!0)&&(a=$(document).height()-$(o).outerHeight(!0)),$(o).css({left:t+"px",top:a+"px"})}$(document).mousemove(a).on("touchmove",a),$(document).mouseup(function(){$("body").css("overflow",""),$(document).off("mousemove")}).on("touchend",function(e){$("body").css("overflow",""),$(document).off("touchmove")})}t='<div onclick="Util.closeAlert(this)" style="height: '+document.documentElement.scrollHeight+'px;display: block;" class="dialog-background"></div>'+('<div class="dialog-panel" id="alertDialogPanel" tabindex="0"><div class="fn-clear dialog-header-bg"><span style="font-size: 14px;">'+t+'</span><a class="icon-close" href="javascript:void(0);" onclick="Util.closeAlert()"><svg><use xlink:href="#close"></use></svg></a></div><div class="dialog-main" style="text-align:center;padding: 30px 10px 40px">'+e+"</div></div>"),$("body").append(t),$("#alertDialogPanel").css({top:($(window).height()-$("#alertDialogPanel").height())/2+"px",left:($(window).width()-$("#alertDialogPanel").width())/2+"px",outline:"none"}).fadeIn(200).focus(),o="#alertDialogPanel",$(".dialog-header-bg").mousedown(a).on("touchstart",a)},makeNotificationRead:function(e,a){return $.ajax({url:Label.servePath+"/notifications/make-read/"+e,type:"GET",cache:!1,success:function(e,t){0===e.code&&(Util.setUnreadNotificationCount(!1),$(".notification li").addClass("read"),a&&($(a).prev().remove(),$(a).remove(),0===$(".home-menu .count").length&&$(".module-header:last > span").remove()))}}),!1},_initCommonHotKey:function(){if(!Label.userKeyboardShortcutsStatus||"1"===Label.userKeyboardShortcutsStatus)return!1;function i(e){var t=$(".list > ul > li.focus"),a=0===$(".radio-btn").length?0:48;if(1===t.length){if("top"===e||"bottom"===e)return $(window).scrollTop(t.offset().top-a);($(window).height()+$(window).scrollTop()<t.offset().top+t.outerHeight()||$(window).scrollTop()>t.offset().top)&&("down"===e?$(window).scrollTop(t.offset().top-($(window).height()-t.outerHeight())):$(window).scrollTop(t.offset().top-a))}}0===$("#articleTitle").length&&$(document).bind("keydown","c",function(e){return Util.prevKey||(window.location=Label.servePath+"/post?type=0"),!1}),$(document).bind("keyup","g",function(){return Util.prevKey="g",setTimeout(function(){Util.prevKey=void 0},1e3),!1}).bind("keyup","s",function(){return $("#search").focus(),!1}).bind("keyup","t",function(){return void 0===Util.prevKey&&Util.goTop(),!1}).bind("keyup","n",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/notifications"),!1}).bind("keyup","h",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/hot"),!1}).bind("keyup","i",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath),!1}).bind("keyup","r",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/recent"),!1}).bind("keyup","p",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/perfect"),!1}).bind("keyup","Shift+/",function(e){return window.open(Label.servePath+"/article/1631459254239"),!1}).bind("keyup","j",function(e){var t=".content .list:last > ul > ",a=(1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus"));return 0===a.length?$(t+"li:first").addClass("focus"):1===a.next().length&&(a.next().addClass("focus"),a.removeClass("focus")),i("down"),!1}).bind("keyup","k",function(e){var t=".content .list:last > ul > ",a=(1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus"));return 0===a.length?$(t+"li:last").addClass("focus"):1===a.prev().length&&(a.prev().addClass("focus"),a.removeClass("focus")),i("up"),!1}).bind("keyup","f",function(e){var t=".content .list:last > ul > ";return 1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus").removeClass("focus"),$(t+"li:first").addClass("focus"),i("top"),!1}).bind("keyup","l",function(e){var t;return Util.prevKey||(t=".content .list:last > ul > ",1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus").removeClass("focus"),$(t+"li:last").addClass("focus"),i("bottom")),!1}).bind("keyup","o",function(e){var t;return 1===$("#comments").length||(t=(t=(t=$(".content .list:last > ul > li.focus > h2 > a").attr("href"))||$(".content .list:last > ul > li.focus .fn-flex-1 > h2 > a").attr("href"))||$(".content .list:last > ul > li.focus h2.fn-flex-1 > a").attr("href"))&&(window.location=t),!1}).bind("keyup","return",function(e){var t;return 1===$("#comments").length||(t=(t=(t=$(".content .list:last > ul > li.focus > h2 > a").attr("href"))||$(".content .list:last > ul > li.focus .fn-flex-1 > h2 > a").attr("href"))||$(".content .list:last > ul > li.focus h2.fn-flex-1 > a").attr("href"))&&(window.location=t),!1})},notifyMsg:function(t){if(!("Notification"in window))return!1;function a(e){(e=new Notification(Label.visionLabel,{body:Label.desktopNotificationTemplateLabel.replace("${count}",e),icon:Label.staticServePath+"/images/faviconH.png"})).onclick=e.onerror=function(){window.location=Label.servePath+"/notifications"}}"granted"===Notification.permission?a(t):"denied"!==Notification.permission&&Notification.requestPermission(function(e){"granted"===e&&a(t)})},processClipBoard:function(e,i){if(""===e.getData("text/html")&&2===e.items.length)return"";var t,a=!1,e=toMarkdown(e.getData("text/html"),{converters:[{filter:"img",replacement:function(e,t){if(1===t.attributes.length)return"";var a={url:t.src};return $.ajax({url:Label.servePath+"/fetch-upload",type:"POST",data:JSON.stringify(a),cache:!1,success:function(e,t){var a;0===e.code&&(a=(a=i.getValue()).replace(e.originalURL,e.url),i.setValue(a))}}),"![]("+t.src+")"}},{filter:["pre","code"],replacement:function(e){return 1<e.split("\n").length&&(a=!0),"`"+e+"`"}}],gfm:!0});return a?event.originalEvent.clipboardData.getData("text/plain"):((t=document.createElement("div")).innerHTML=e,t.innerText.replace(/\n{2,}/g,"\n\n").replace(/(^\s*)|(\s*)$/g,""))},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},getDeviceByUa:function(e){$.ua.set(e);e=$.ua.device.model||$.ua.os.name;return e=e&&"Windows"!==e?e:""},initSearch:function(e,t,a){var i=algoliasearch(e,t).initIndex(a);$("#search").autocomplete({hint:!1,templates:{footer:'<div class="fn-right fn-pointer" onclick="window.open(\'https://www.algolia.com\')"><span class="ft-gray">With &hearts; from</span> <img src="'+Label.staticServePath+'/images/services/algolia128x40.png" /> </div>'}},[{source:function(e,a){i.search(e,{hitsPerPage:20},function(e,t){e?a([]):a(t.hits,t)})},displayKey:"name",templates:{suggestion:function(e){return e._highlightResult.articleTitle.value}}}]).on("autocomplete:selected",function(e,t,a){window.open(Label.servePath+"/article/"+t.oId)}).bind("keyup","esc",function(){$(this).blur()})},newVditor:function(e){Label.emoji||$.ajax({url:Label.servePath+"/users/emotions",type:"GET",cache:!0,async:!1,success:function(e){Label.emoji={},e.data.forEach(function(e){var t=Object.keys(e)[0];Label.emoji[t]=e[t]})}});var t={outline:e.outline||{enable:!1},after:e.after||void 0,typewriterMode:e.typewriterMode||!1,cache:{enable:e.cache||!1},input:e.input,preview:{delay:500,mode:e.preview.mode,url:Label.servePath+"/markdown",parse:function(e){"none"!==e.style.display&&Util.LazyLoadImage()},hljs:{enable:!Label.luteAvailable}},upload:{max:Label.fileMaxSize,url:Label.servePath+"/upload",filename:function(e){return e.replace(/\?|\\|\/|:|\||<|>|\*|\[|\]|\s+/g,"-")},accept:".zip,.rar,.7z,.tar,.gzip,.bz2,.jar,.jpg,.jpeg,.png,.gif,.webp,.webm,.bmp,.mp3,.mp4,.wav,.mov,.weba,.mkv"},placeholder:e.placeholder,height:e.height,counter:{enable:!!e.counter,max:e.counter},resize:{enable:e.resize.enable,position:e.resize.position},lang:Label.langLabel,hint:{parse:!1,emojiTail:'<a href="'+Label.servePath+'/settings/function" target="_blank">设置常用表情</a>',emoji:Label.emoji,extend:[{key:"@",hint:function(a){var i=[];return $.ajax({url:Label.servePath+"/users/names",type:"POST",async:!1,data:JSON.stringify({name:a}),success:function(e){if(0===e.code){for(var t=0;t<e.data.length;t++)i.push({value:"@"+e.data[t].userName+" ",html:'<img src="'+e.data[t].userAvatarURL48+'"/>'+e.data[t].userName});""===a&&i.push({html:'<img src="'+Label.staticServePath+'/images/user-thumbnail.png"/> 参与者',value:"@participants "})}else alert(e.msg)}}),i}}]},esc:e.esc,ctrlEnter:e.ctrlEnter};return $(window).width()<768?(t.toolbar=["emoji","link","upload","edit-mode",{name:"more",toolbar:["insert-after","fullscreen","preview","info","help"]}],t.resize.enable=!1):e.toolbar&&(t.toolbar=e.toolbar),new Vditor(e.id,t)},setUnreadNotificationCount:function(r){$.ajax({url:Label.servePath+"/notifications/unread/count",type:"GET",cache:!1,success:function(e,t){function a(e){var t="",a='<span onclick="Util.makeNotificationRead(\'${markReadType}\');return false;" aria-label="'+Label.makeAsReadLabel+'" class="fn-right tooltipped tooltipped-nw"><svg><use xlink:href="#check"></use></svg></span>';return 0<e.unreadCommentedNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/commented">'+Label.notificationCommentedLabel+' <span class="count">'+e.unreadCommentedNotificationCnt+"</span>"+a.replace("${markReadType}","commented")+"</a></li>"),0<e.unreadReplyNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/reply">'+Label.notificationReplyLabel+' <span class="count">'+e.unreadReplyNotificationCnt+"</span>"+a.replace("${markReadType}","reply")+"</a></li>"),0<e.unreadAtNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/at">'+Label.notificationAtLabel+' <span class="count">'+e.unreadAtNotificationCnt+"</span>"+a.replace("${markReadType}","at")+"</a></li>"),0<e.unreadFollowingNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/following">'+Label.notificationFollowingLabel+' <span class="count">'+e.unreadFollowingNotificationCnt+"</span>"+a.replace("${markReadType}","following")+"</a></li>"),0<e.unreadPointNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/point">'+Label.pointLabel+' <span class="count">'+e.unreadPointNotificationCnt+"</span></a></li>"),0<e.unreadBroadcastNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/broadcast">'+Label.sameCityLabel+' <span class="count">'+e.unreadBroadcastNotificationCnt+"</span></a></li>"),0<e.unreadSysAnnounceNotificationCnt&&(t+='<li><a href="'+Label.servePath+'/notifications/sys-announce">'+Label.systemLabel+' <span class="count">'+e.unreadSysAnnounceNotificationCnt+"</span></a></li>"),0<e.unreadNewFollowerNotificationCnt&&(t+='<li><a href="'+Label.servePath+"/member/"+Label.currentUserName+'/followers">'+Label.newFollowerLabel+' <span class="count">'+e.unreadNewFollowerNotificationCnt+"</span></a></li>"),t}var i=e.unreadNotificationCnt;if($.ua.set(navigator.userAgent),$.ua.device.type&&"mobile"===$.ua.device.type){if(0<i){$("#aNotifications").removeClass("no-msg").addClass("msg").text(i).attr("href","javascript:void(0)"),0===e.userNotifyStatus&&window.localStorage.hadNotificate!==i.toString()&&r&&(Util.notifyMsg(i),window.localStorage.hadNotificate=i);var n=a(e);if(1===$("#notificationsPanel").length)return $("#notificationsPanel ul").html(n),!1;$(".main:first").prepend('<div id="notificationsPanel" class="tab-current fn-clear fn-none"><ul class="tab fn-clear">'+n+"</ul></div>"),$("#aNotifications").click(function(){$("#notificationsPanel").slideToggle()})}else window.localStorage.hadNotificate="false",$("#aNotifications").removeClass("msg").addClass("no-msg").text(i).attr("href",Label.servePath+"/notifications");return!1}var o='<svg style="height: 15px;padding-top: 2px;pointer-events: none;">  <use xlink:href="#notification"></use></svg>&nbsp;';if(0<i){$("#aNotifications").removeClass("no-msg tooltipped tooltipped-w").addClass("msg").html(o+i).attr("href","javascript:void(0)"),0===e.userNotifyStatus&&window.localStorage.hadNotificate!==i.toString()&&r&&(Util.notifyMsg(i),window.localStorage.hadNotificate=i);n=a(e);if(1===$("#notificationsPanel").length)return $("#notificationsPanel ul").html(n),!1;$("#aNotifications").after('<div id="notificationsPanel" class="module person-list"><ul>'+n+"</ul></div>"),$("#aNotifications").click(function(){$("#notificationsPanel").show()}),$("body").click(function(e){"aNotifications"!==e.target.id&&"notificationsPanel"!==$(e.target).closest(".module").attr("id")&&$("#notificationsPanel").hide()})}else window.localStorage.hadNotificate="false",$("#notificationsPanel").remove(),$("#aNotifications").removeClass("msg").addClass("no-msg tooltipped tooltipped-w").html(o+i).attr("href",Label.servePath+"/notifications")}})},follow:function(a,i,n,o){if(!Label.isLoggedIn)return Util.needLogin(),!1;if($(a).hasClass("disabled"))return!1;var e={followingId:i};$(a).addClass("disabled"),$.ajax({url:Label.servePath+"/follow/"+n,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code&&($(a).removeClass("disabled"),void 0!==o?"article"===n||"tag"===n?$(a).html('<svg class="icon-star"><use xlink:href="#star"></use></svg> '+(o+1)).attr("onclick","Util.unfollow(this, '"+i+"', '"+n+"', "+(o+1)+")").attr("aria-label",Label.uncollectLabel).addClass("ft-red"):"article-watch"===n&&$(a).html('<svg class="icon-view"><use xlink:href="#view"></use></svg> '+(o+1)).attr("onclick","Util.unfollow(this, '"+i+"', '"+n+"', "+(o+1)+")").attr("aria-label",Label.unfollowLabel).addClass("ft-red"):$(a).attr("onclick","Util.unfollow(this, '"+i+"', '"+n+"')").text("article"===n?Label.uncollectLabel:Label.unfollowLabel))},complete:function(){$(a).removeClass("disabled")}})},unfollow:function(a,i,n,o){if($(a).hasClass("disabled"))return!1;var e={followingId:i};$(a).addClass("disabled"),$.ajax({url:Label.servePath+"/unfollow/"+n,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){0===e.code&&(void 0!==o?"article"===n||"tag"===n?$(a).removeClass("ft-red").html('<svg class="icon-star"><use xlink:href="#star"></use></svg> '+(o-1)).attr("onclick","Util.follow(this, '"+i+"', '"+n+"',"+(o-1)+")").attr("aria-label",Label.collectLabel):"article-watch"===n&&$(a).removeClass("ft-red").html('<svg class="icon-view"><use xlink:href="#view"></use></svg> '+(o-1)).attr("onclick","Util.follow(this, '"+i+"', '"+n+"',"+(o-1)+")").attr("aria-label",Label.followLabel):$(a).attr("onclick","Util.follow(this, '"+i+"', '"+n+"')").text("article"===n?Label.collectLabel:Label.followLabel))},complete:function(){$(a).removeClass("disabled")}})},goTop:function(){$("html, body").animate({scrollTop:0},800)},goLogin:function(){var e;-1===location.href.indexOf("/login")&&(e=location.href,0===location.search.indexOf("?goto")&&(e=location.href.replace(location.search,"")),window.location.href=Label.servePath+"/login?goto="+encodeURIComponent(e))},needLogin:function(){Util.goLogin()},goRegister:function(){var e;-1===location.href.indexOf("/register")&&(e=location.href,0===location.search.indexOf("?goto")&&(e=location.href.replace(location.search,"")),window.location.href=Label.servePath+"/register?goto="+encodeURIComponent(e))},_kill:function(){"IE"===$.ua.browser.name&&parseInt($.ua.browser.version)<10&&$.ajax({url:Label.servePath+"/kill-browser",type:"GET",cache:!1,success:function(e,t){$("body").append(e),$("#killBrowser").dialog({modal:!0,hideFooter:!0,height:345,width:600}),$("#killBrowser").dialog("open")}})},_initActivity:function(){var e=$(".person-info"),t=e.data("percent"),a=0,i=0,n=0;t<=25?a=parseInt(t/.25):t<=75?(a=100,i=parseInt((t-25)/2/.25)):t<=100&&(i=a=100,n=parseInt((t-75)/.25)),e.find(".bottom").css({width:a+"%",left:(100-a)/2+"%"}),e.find(".top-left").css({width:parseInt(n/2)+"%",left:0}),e.find(".top-right").css({width:parseInt(n/2)+"%",right:0}),e.find(".left").css({height:i+"%",top:100-i+"%"}),e.find(".right").css({height:i+"%",top:100-i+"%"})},_initBreezemoon:function(t,e,a){0!==t.length&&(e.keypress(function(e){13===e.keyCode&&t.click()}),t.click(function(){a?"disabled"!==t.attr("disabled")&&(t.attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/breezemoon",type:"POST",cache:!1,headers:{csrfToken:$(this).data("csrf")},data:JSON.stringify({breezemoonContent:e.val()}),success:function(e){0===e.code?window.location.reload():Util.alert(e.msg)},complete:function(){t.css("opacity",1).removeAttr("disabled")}})):Util.goLogin()}))},init:function(e){if($.ua.set(navigator.userAgent),"mobile"!==$.ua.device.type&&($("body").append('<div id="userCard" style="position: absolute; z-index: 130; right: auto; display: none; "></div>'),Util.listenUserCard()),this._kill(),this._initNav(),this._initActivity(),1===$(".pagination select").length&&$(".pagination select").change(function(){var e=$(this).data("url")+"?p="+$(this).val();$(this).data("param")&&(e+="&"+$(this).data("param")),window.location.href=e}),$(".nav input.search").focus(function(){$(".nav .tags").css("visibility","hidden")}).blur(function(){$(".nav .tags").css("visibility","visible")}),$(window).scroll(function(){20<$(window).scrollTop()&&0===$(".radio-btn").length?$(".go-top").show():$(".go-top").hide()}),Util.parseMarkdown(),Util.parseHljs(),e&&(window.localStorage.hadNotificate||(window.localStorage.hadNotificate="false"),Util.setUnreadNotificationCount(!0)),$(window).keyup(function(e){27===e.keyCode&&Util.closeAlert()}),this._initBreezemoon($("#breezemoonPostBtn"),$("#breezemoonInput"),e),this._initCommonHotKey(),e)return!1;$("body").click(function(e){0===$(e.target).closest(".nav .form").length&&$(".nav .form").hide()})},userCardCache:new Map,listenUserCard:function(){let e=(new Date).getTime(),t=0;function i(o){const t=$(o).attr("aria-label");if(void 0!==t){let n=Util.userCardCache.get(t);n||$.ajax({url:Label.servePath+"/user/"+t,type:"GET",cache:!1,async:!1,headers:{csrfToken:Label.csrfToken},success:function(e){n=e,Util.userCardCache.set(t,n)}});{var r=n;var{oId:l,userAvatarURL:s,userCity:c,userIntro:u,userName:d,userNickname:f,userOnlineFlag:g,userPoint:h,userRole:p,cardBg:v,canFollow:m,userNo:b,userAppRole:w}=r,r=JSON.parse(r.sysMetal);let t=`<div class="user-card${v?" user-card--bg":""}" style="background-image: url(${v})" id="userCardContent">
<div>
<a href="${Label.servePath}/member/${d}">
<div class="avatar-mid-card" style="background-image: url(${s});"></div>
</a>
<div class="user-card__meta">
<div class="fn__ellipsis">
<a class="user-card__name" href="${Label.servePath}/member/${d}"><b>${f}</b></a>
<a class="ft-gray ft-smaller" href="${Label.servePath}/member/${d}"><b>${d}</b></a>
</div>
<div class="user-card__info vditor-reset">
${u||`摸鱼派 ${b} 号成员，<b>${["黑客","画家"][w]}</b>`}
</div>`;var y=r.list;if(y&&y.length){t+='<div class="user-card__info vditor-reset">';for(let e=0;e<y.length;e++)t+=`<img title='${y[e].description}' src='${Util.genMetal(y[e].name,y[e].attr)}'/>`;t+="</div>"}let e="https://pwl.stackoverflow.wiki/newRole.png";switch(p){case"管理员":e="https://pwl.stackoverflow.wiki/adminRole.png";break;case"OP":e="https://pwl.stackoverflow.wiki/opRole.png";break;case"纪律委员":e="https://pwl.stackoverflow.wiki/policeRole.png";break;case"超级会员":e="https://pwl.stackoverflow.wiki/svipRole.png";break;case"成员":e="https://pwl.stackoverflow.wiki/vipRole.png"}t+=`<div class="user-card__icons fn__flex"><div class="fn__flex-1">
<a href="https://fishpi.cn/article/1630575841478" class="tooltipped__n tooltipped-new" aria-label="用户分组：${p}">
<img style="height: 20px;margin: 0;" src="${e}"/></a>
<a href="${Label.servePath}/member/${d}/points" class="tooltipped-new tooltipped__n" aria-label="${h} 积分">
<svg><use xlink:href="#iconPoints"></use></svg>
</a>`,""!==c&&(t+=`<a href="${Label.servePath}/city/${c}" class="tooltipped-new tooltipped__n" rel="nofollow" aria-label="${c}">
<svg><use xlink:href="#icon-local"></use></svg>
</a>`),t+=`<a class="tooltipped-new tooltipped__n" rel="nofollow" onclick="#" style="background-color:#eeeeeecc;border-radius:5px;padding:0 7px 0 4px;cursor:default;color:#6d6c6c;font-size:5px;" aria-label="${b} 号成员">
<svg style="height: 12px; vertical-align: -4.5px"><use xlink:href="#no"></use></svg>
<span style="margin: 0;float: none;vertical-align: -3px;">${b}</span> 
</a>
</div>
${g?'<span style="background-color:#d23f31;color:#fff;font-size:12px;line-height:20px;border-radius:3px;height:20px;display:inline-block;padding:0 5px;vertical-align:middle;box-sizing:border-box;">在线</span>':'<span style="background-color:rgba(0,0,0,0.54);color:#fff;font-size:12px;line-height:20px;border-radius:3px;height:20px;display:inline-block;padding:0 5px;vertical-align:middle;box-sizing:border-box;">离线</span>'}
<div class="fn__shrink">
<a class="green small btn" href="${Label.servePath}/chat?toUser=${d}" rel="nofollow">私信</a>`,"yes"===m?t+=`<button class="follow small" onclick="Util.follow(this, '${l}', 'user')"> 关注</button>`:"no"===m&&(t+=`<button class="follow small" onclick="Util.unfollow(this,'${l}','user')">取消关注</button>`),t+="</div></div></div></div></div>",""!==v&&(t+=`<style>#userCardContent > div{background-image: linear-gradient(90deg, rgba(214, 227, 235, 0.36), rgba(255, 255, 255, 0.76), rgba(255, 255, 255, 0.76));}
#userCardContent > div > a > div{width: 105px;height: 105px;top: 80px}</style>`);let a=$(o).offset().left,i=(a+370>$(document.body).width()&&(a-=360),$(o).offset().top-110);i<45&&(i+=155),$("#userCard").html(t).css({left:a+"px",top:i+"px"}).show()}}}function a(){0!==t&&(clearTimeout(t),t=0),e=(new Date).getTime(),t=setTimeout(()=>{(new Date).getTime()-e<=110&&$("#userCard").hide()},100)}$(".avatar, .avatar-small, .avatar-middle, .avatar-mid, .avatar-big, .name-at").unbind().hover(function(a){if($("#userCard").length){let{left:e,top:t}=$(a.target).offset();e+360>$(window).width()&&(e-=360),$("#userCard").css({left:e+"px",top:t<155?t+45:t-110+"px"}).show()}0!==t&&(clearTimeout(t),t=0),e=(new Date).getTime(),setTimeout(()=>0!==$(".avatar:hover, .avatar-small:hover, .avatar-middle:hover, .avatar-mid:hover, .avatar-big:hover, .name-at:hover").length&&i(a.target),80)},a),$("#userCard").unbind().hover(function(){0!==t&&(clearTimeout(t),t=0),e=(new Date).getTime()},a)},initUserChannel:function(e){e=new WebSocket(e);e.onopen=function(){console.log("Connected to user channel websocket.")},e.onmessage=function(e){var t,a,i=JSON.parse(e.data);switch(i.command){case"refreshNotification":"/cr"===window.location.pathname?(Util.makeNotificationRead("at"),Util.setUnreadNotificationCount(!0)):(Util.setUnreadNotificationCount(!0),0!==i.count&&Util.notice("default",3e3,"你有新的通知！<a href='/notifications'>点击查看</a>"));break;case"chatUnreadCountRefresh":0===i.count&&Util.pauseBling(),$("#aChatCount").text(i.count);break;case"newIdleChatMessage":$("#aChatCount").text(parseInt($("#aChatCount").text())+1),"/chat"!==window.location.pathname?(Util.blingChat(),Util.notice("warning",3e3,"叮咚！"+i.senderUserName+" 向你发送了一条私信。<a href='/chat?toUser="+i.senderUserName+"'>点击查看</a>")):(n=i.preview.substring(0,10),o=10<i.preview.length?"...":"",t=i.senderUserName,a=i.senderAvatar,$("#chatTo"+t).length<=0?Chat.addToMessageList(t,a,n):$("#chatTo"+t).find("span").html(n+o),"rgb(241, 241, 241)"!==$("#chatTo"+t).css("background-color")&&$("#chatTo"+t).css("background-color","#fff4eb"),a=$("#chatTo"+t).prop("outerHTML"),$("#chatTo"+t).remove(),$("#chatMessageList").prepend(a));break;case"warnBroadcast":var n=i.warnBroadcastText,o=i.who;Util.alert('<style>.dialog-header-bg {border-radius: 4px 4px 0px 0px; background-color: rgb(151,49,210); color: rgb(255, 255, 255);}.dialog-main {height: 170px;overflow: auto;}</style><div class="fn-hr5"></div>\n<div class="ft__center">\n<div><h1>摸鱼派社区紧急公告</h1><br>'+n+"<br><br>——紧急公告发布人："+o+"</div></div>\n","紧急公告"),Util.alert(n),$(".dialog-background").attr("onclick","")}},e.onclose=function(){console.log("Disconnected to user channel websocket.")},e.onerror=function(e){console.log("ERROR",e)}},blingChat:function(){$("#aChat").removeClass("no-msg").addClass("msg"),Util.isBlinging||(Util.isBlinging=!0,$("#idleTalkIconContainer").html('<use xlink:href="#redIdleChat"></use>'),setTimeout(function(){$("#idleTalkIconContainer").html('<use xlink:href="#idleChat"></use>')},1e3),bling=setInterval(function(){$("#idleTalkIconContainer").html('<use xlink:href="#redIdleChat"></use>'),setTimeout(function(){$("#idleTalkIconContainer").html('<use xlink:href="#idleChat"></use>')},1e3)},2e3))},pauseBling:function(){$("#aChat").removeClass("msg").addClass("no-msg"),Util.isBlinging&&(Util.isBlinging=!1,clearInterval(bling))},_initNav:function(){var e=location.href;$(".user-nav > a").each(function(){0===e.indexOf($(this).attr("href"))?$(this).addClass("current"):"/register"===location.pathname?$(".user-nav a:last").addClass("current"):"/login"===location.pathname?$(".user-nav a:first").addClass("current"):0!==e.indexOf(Label.servePath+"/settings")&&0!==e.indexOf($("#aPersonListPanel").data("url"))||$("#aPersonListPanel").addClass("current")}),$(".nav .avatar-small").parent().click(function(){$("#personListPanel").show()}),$("body").click(function(e){"aPersonListPanel"!==$(e.target).closest("a").attr("id")&&"personListPanel"!==$(e.target).closest(".module").attr("id")&&$("#personListPanel").hide()}),1===$(".nav-tabs a:last").length&&0<$(".nav-tabs a:last")[0].offsetTop&&$(".nav-tabs").mouseover(function(){$(".user-nav").hide()}).mouseout(function(){$(".user-nav").show()})},logout:function(){window.localStorage&&(window.localStorage.clear(),window.localStorage.hadNotificate="false"),window.location.href=Label.servePath+"/logout?goto="+Label.servePath},startsWith:function(e,t){return e.match("^"+t)==t},mouseClickEffects:function(){var o=0;jQuery(document).ready(function(n){n("html").click(function(e){var t,a=18,i=(10==++o?t=n("<b></b>").text("OωO"):20===o?t=n("<b></b>").text("(๑•́ ∀ •̀๑)"):30===o?t=n("<b></b>").text("(๑•́ ₃ •̀๑)"):40===o?t=n("<b></b>").text("(๑•̀_•́๑)"):50===o?t=n("<b></b>").text("（￣へ￣）"):60===o?t=n("<b></b>").text("(╯°口°)╯(┴—┴"):70===o?t=n("<b></b>").text("૮( ᵒ̌皿ᵒ̌ )ა"):80===o?t=n("<b></b>").text("╮(｡>口<｡)╭"):90===o?t=n("<b></b>").text("( ง ᵒ̌皿ᵒ̌)ง⁼³₌₃"):100<=o&&o<=105?t=n("<b></b>").text("(ꐦ°᷄д°᷅)"):(t=n('<svg><use xlink:href="#heart"></use></svg>'),a=Math.round(14*Math.random()+6)),e.pageX),e=e.pageY;t.css({"z-index":9999,top:e-20,left:i,position:"absolute",color:"#E94F06","font-size":a,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),n("body").append(t),t.animate({top:e-180,opacity:0},1500,function(){t.remove()})})})},notice:function(e,t,a,i){void 0!==i?$.tooltips(a,{type:e,duration:t,callback:i}):$.tooltips(a,{type:e,duration:t})}},Validate={goValidate:function(e){for(var t="<ul>",a=0;a<e.data.length;a++)Validate.validate(e.data[a])||(t+="<li>"+e.data[a].msg+"</li>");return"<ul>"===t?(e.target.html(""),e.target.removeClass("error"),!0):(e.target.html(t+"</ul>"),e.target.addClass("error"),!1)},validate:function(e){var t=!0,a="",a="editor"===e.type?e.target.getValue():"imgSrc"===e.type?e.target.attr("src"):"imgStyle"===e.type?e.target.data("imageurl"):e.target.val().toString().replace(/(^\s*)|(\s*$)/g,"");switch(e.type){case"email":/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e.target.val())||(t=!1);break;case"password":!(e.target.val().length<6||16<e.target.val().length)&&/\d/.test(e.target.val())&&/[A-Za-z]/.test(e.target.val())||(t=!1);break;case"confirmPassword":e.target.val()!==e.original.val()&&(t=!1);break;case"tags":var i=a.split(",");(""===a||7<i.length)&&(t=!1);for(var n=0;n<i.length;n++)if(""===i[n].replace(/(^\s*)|(\s*$)/g,"")||50<i[n].replace(/(^\s*)|(\s*$)/g,"").length){t=!1;break}break;case"url":case"imgSrc":case"imgStyle":(""===a||""!==a&&(!/^\w+:\/\//.test(a)||100<a.length))&&(t=!1);break;case"phone":/^[1][0-9]{10}$/.test(e.target.val())||(t=!1);break;default:t=a.length<=e.max&&a.length>=(e.min||0)}return t}},Label={},pngMagic=[137,80,78,71,13,10,26,10],jpeg_jfif=[74,70,73,70],jpeg_exif=[69,120,105,102],jpegMagic=[255,216,255,224],gifMagic0=[71,73,70,56,55,97],getGifMagic1=[71,73,70,56,57,97],wavMagic1=[82,73,70,70],wavMagic2=[87,65,86,69];function arraycopy(e,t,a,n,o){for(i=0;i<o;i++)a[n+i]=e[t+i]}function arrayEquals(e,t){if("undefined"!=e&&"undefined"!=t&&e instanceof Array&&t instanceof Array){if(e.length!=t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}return!1}function isImage(e){return null!==getImageMime(e)}function getImageMime(e){if(null==e||"undefined"==e||e.length<8)return null;var t=[];return arraycopy(e,0,t,0,6),isGif(t)?"image/gif":(arraycopy(e,6,t=[],0,4),isJpeg(t)?"image/jpeg":(arraycopy(e,0,t=[],0,8),isPng(t)?"image/png":null))}function isAudio(e){if(null==e||"undefined"==e||e.length<12)return null;var t=[],a=(arraycopy(e,0,t,0,4),[]);return arraycopy(e,8,a,0,4),isWav(t,a)?"audio/wav":null}function isGif(e){return arrayEquals(e,gifMagic0)||arrayEquals(e,getGifMagic1)}function isJpeg(e){return arrayEquals(e,jpegMagic)||arrayEquals(e,jpeg_jfif)||arrayEquals(e,jpeg_exif)}function isPng(e){return arrayEquals(e,pngMagic)}function isWav(e,t){return arrayEquals(e,wavMagic1)&&arrayEquals(t,wavMagic2)}function getUUID(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==e?t:3&t|8).toString(16)}).replace(new RegExp("-","g"),"")}var Audio={availabel:!1,wavFileBlob:null,recorderObj:null,init:function(n){var e=new BrowserGetUserMediaDetection;e.getUserMediaSupported()?(navigator.getUserMedia=e.getUserMediaMethod(),navigator.getUserMedia({audio:!0},function(e){var t=PredefinedRecordingModes.MONO_5_KHZ,a=t.getSampleRate(),t=t.getChannelCount(),i=new BrowserWindowAudioContextDetection;i.windowAudioContextSupported()?(i=i.getWindowAudioContextMethod(),Audio.recorderObj=new SoundRecorder(i,2048,a,t),Audio.recorderObj.init(e),Audio.recorderObj.recorder.onaudioprocess=function(e){var t;Audio.recorderObj.isRecording()&&(t=e.inputBuffer.getChannelData(0),e=e.inputBuffer.getChannelData(1),Audio.recorderObj.cloneChannelData(t,e))},Audio.availabel=!0,n&&n()):console.log("getUserMedia->success(): Unable to detect window audio context, cannot continue.")},function(e){console.log("getUserMedia->failure(): ERROR: Microphone access request failed!");switch(e.name){case"PermissionDeniedError":Label.recordDeniedLabel;break;case"DevicesNotFoundError":Label.recordDeviceNotFoundLabel;break;default:e.name}})):console.log("ERROR: getUserMedia not supported by browser.")},handleStartRecording:function(){Audio.recorderObj.startRecordingNewWavFile()},handleStopRecording:function(){Audio.recorderObj.stopRecording(),Audio.wavFileBlob=Audio.recorderObj.buildWavFileBlob()}};function Rotate(i){let n=!1,o=!1;this.submit=function(){if(!o){o=!0;let e=0,t,a;void 0===a&&(null!==(t=document.getElementById(i).getAttribute("style"))&&void 0!==t&&""!==t?t.endsWith(";")||(t+=";"):t="",a=setInterval(function(){360<(e+=5)&&(e=0),document.getElementById(i).setAttribute("style",t+"-webkit-transform: rotate("+e+"deg);"),0===e&&n&&(clearInterval(a),document.getElementById(i).setAttribute("style",t),o=!1)},15))}},this.stop=function(){n=!0},String.prototype.endWith=function(e){var t=this.length-e.length;return 0<=t&&this.lastIndexOf(e)===t}}