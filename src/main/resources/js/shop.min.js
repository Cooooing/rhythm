var Shop={history:[],cursor:1,init:function(){Shop.log("Client","正在连接服务器，请稍等..."),Shop.resetInput(),$("body").on("keydown",function(o){if(13===o.keyCode){var e=$(".i-cmd").text();if(Shop.history[Shop.history.length]=e,Shop.log("Input",e),"history"===e){let e="";e+="===== 命令历史 =====<br>";for(let o=0;o<Shop.history.length;o++)e+=o+"&nbsp;"+Shop.history[o]+"<br>";Shop.log("Client","<br>"+e)}else $.ajax({url:Label.servePath+"/shop",method:"post",data:JSON.stringify({command:e}),cache:!1,async:!0});setTimeout(function(){Shop.resetInput(),Shop.cursor=Shop.history.length},100)}else 38===o.keyCode?(Shop.cursor<=0&&(Shop.cursor=1),Shop.cursor--,console.log(Shop.cursor),$(".i-cmd").text(Shop.history[Shop.cursor])):40===o.keyCode?(Shop.cursor>Shop.history.length-1&&(Shop.cursor=Shop.history.length-2),Shop.cursor<=-1&&(Shop.cursor=-1),Shop.cursor++,console.log(Shop.cursor),Shop.cursor===Shop.history.length?$(".i-cmd").text(""):$(".i-cmd").text(Shop.history[Shop.cursor])):9===o.keyCode&&$(".i-cmd").text(Shop.lenovo($(".i-cmd").text()))}),$(".subInput").on("click",function(){setTimeout(function(){console.log("Reset cursor"),$(".i-cmd").focus()},100)})},lenovo:function(o){var s=["help","history"];let n=o.split(" ");var t=n[n.length-1];let l="";for(let e=0;e<s.length;e++){let o=s[e];if(o.startsWith(t)){n[n.length-1]=o;for(let o=0;o<n.length;o++){var r=n[o];o===n.length-1?l+=r:l+=r+" "}break}}return l},log:function(e,s){if("Input"===(e=void 0===e?"N/A":e))$(".logs").append("\n<div class='subLog'>>&nbsp;"+s+"</div>");else{let o=new Date;e="["+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)+"&nbsp;"+e+"]&nbsp;",$(".logs").append("\n<div class='subLog'>"+e+s+"</div>")}},resetInput:function(o,e){void 0===e&&(e=""),void 0===o&&(o="~"),$(".input").html("<div class='subInput'><span class='i-name'>"+Label.currentUserName+"</span><span class='i-at'>@</span><span class='i-host'>"+Label.servePath.replace("http://","").replace("https://","")+"</span><span class='i-colon'>:</span><span class='i-location'>"+o+"</span><span class='i-user-as'>$</span><span class='i-space'>&nbsp;</span><span class='i-cmd' contenteditable='true'>"+e+"</span></div>"),$(".i-cmd").focus()}},ShopChannel={ws:void 0,init:function(o){ShopChannel.ws=new WebSocket(o),ShopChannel.ws.onopen=function(){Shop.log("Client","连接成功，已启动命令通道。")},ShopChannel.ws.onmessage=function(o){o=JSON.parse(o.data);Shop.log("Server",o.message)},ShopChannel.ws.onclose=function(){Shop.log("Client","与服务端的连接已断开，正在尝试重连..."),setInterval(function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})},1e4)},ShopChannel.ws.onerror=function(o){Shop.log("Client","连接出错，正在尝试重连..."),setInterval(function(){$.ajax({url:Label.servePath+"/shop",method:"get",success:function(){location.reload()}})},1e4)}}};