var IdleTalk={editor:void 0,destroy:function(e){$("#"+e).remove(),void 0===$("#received").find("li")[0]&&void 0===$("#received").find(".nope")[0]&&$("#received").append('<div class="nope">没有收到任何来信</div>')},revoke:function(n){!0===confirm("确定要撤回这封信吗？对方将无法再打开这封信，同时你的积分将不会被退还。")&&$.ajax({url:Label.servePath+"/idle-talk/revoke?mapId="+n,type:"GET",headers:{csrfToken:Label.csrfToken},cache:!1,success:function(e){-1===e.code?Util.notice("danger",3e3,e.msg):($("#"+n).remove(),void 0===$("#sent").find("li")[0]&&void 0===$("#sent").find(".nope")[0]&&$("#sent").append('<div class="nope">没有未读的发信</div>'),Util.notice("success",3e3,"撤回成功。"))}})},seek:function(n){$.ajax({url:Label.servePath+"/idle-talk/seek?mapId="+n,type:"GET",headers:{csrfToken:Label.csrfToken},cache:!1,success:function(e){-1===e.code?Util.notice("danger",3e3,e.msg):($("#"+n).append("<div id='seek-"+n+"' style='background-color: #F7F7F7;display:none;overflow: auto;padding: 20px;'>"+e.data+"<br><button class='green' onclick='IdleTalk.destroy("+n+")'>朕已阅，可以销毁了</button></div>"),$("#seek-"+n).show(200))}})},send:function(){$.ajax({url:Label.servePath+"/idle-talk/send",type:"POST",headers:{csrfToken:Label.csrfToken},cache:!1,data:JSON.stringify({userName:$("#userForm").val(),theme:$("#themeForm").val(),content:IdleTalk.getContent()}),success:function(e){-1===e.code?Util.notice("danger",3e3,e.msg):($("#userForm").val(""),$("#themeForm").val(""),IdleTalk.editor.setValue(""),Util.notice("success",3e3,"信柬已发送，请静候佳音！"))}})},init:function(){IdleTalk.editor=Util.newVditor({id:"messageContent",cache:!0,preview:{mode:"editor"},resize:{enable:!0,position:"top"},height:200,counter:4096,placeholder:"信柬内容（最长20480个字）"});var e=IdleTalk.getUrlPath("toUser");!1!==e&&(IdleTalk.expand(),$("#userForm").val(e))},getContent:function(){return IdleTalk.editor.getValue()},expand:function(){$("#sendMessageWindow").is(":hidden")?($("#title").css("padding","230px 0 20px 0"),$("#sendMessageWindow").fadeIn(200)):($("#title").css("padding","20px 0 20px 0"),$("#sendMessageWindow").fadeOut(200))},getUrlPath:function(e){for(var n=window.location.search.substring(1).split("&"),t=0;t<n.length;t++){var i=n[t].split("=");if(i[0]==e)return i[1]}return!1}};$(document).ready(function(){IdleTalk.init()});