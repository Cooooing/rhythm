var IdleTalk={editor:void 0,destroy:function(e){$("#"+e).remove(),void 0===$("#received").find("li")[0]&&void 0===$("#received").find(".nope")[0]&&$("#received").append('<div class="nope"><svg><use xlink:href="#nope"></use></svg> 没有收到任何来信</div>')},revoke:function(n){!0===confirm("确定要撤回这封信吗？对方将无法再打开这封信，同时你的积分将不会被退还。")&&$.ajax({url:Label.servePath+"/idle-talk/revoke?mapId="+n,type:"GET",headers:{csrfToken:Label.csrfToken},cache:!1,success:function(e){-1===e.code?Util.notice("danger",3e3,e.msg):($("#"+n).remove(),void 0===$("#sent").find("li")[0]&&void 0===$("#sent").find(".nope")[0]&&$("#sent").append('<div class="nope"><svg><use xlink:href="#nope"></use></svg> 没有未读的发信</div>'),Util.notice("success",3e3,"撤回成功。"))}})},reply:function(e,n){$("#sendMessageWindow").is(":hidden")&&($("#title").css("padding","230px 0 20px 0"),$("#sendMessageWindow").fadeIn(200)),$("#userForm").val(e),$("#themeForm").val("回复："+n),document.documentElement.scrollTop=0},seek:function(n,t,s){$.ajax({url:Label.servePath+"/idle-talk/seek?mapId="+n,type:"GET",headers:{csrfToken:Label.csrfToken},cache:!1,success:function(e){-1===e.code?Util.notice("danger",3e3,e.msg):($("#"+n).append("<div id='seek-"+n+"' style='background-color: #F7F7F7;display:none;overflow: auto;padding: 20px;'>"+e.data+"<br><button class='btn' style='margin-right: 10px' onclick='IdleTalk.reply(\""+t+'", "'+s+"\")'>回复</button><button class='green' onclick='IdleTalk.destroy("+n+")'>已阅，可以销毁了</button></div>"),$("#seek-"+n).show(200))}})},send:function(){$.ajax({url:Label.servePath+"/idle-talk/send",type:"POST",headers:{csrfToken:Label.csrfToken},cache:!1,data:JSON.stringify({userName:$("#userForm").val(),theme:$("#themeForm").val(),content:IdleTalk.getContent()}),success:function(e){-1===e.code?Util.notice("danger",3e3,e.msg):($("#userForm").val(""),$("#themeForm").val(""),IdleTalk.editor.setValue(""),Util.notice("success",3e3,"私信已发送，请静候佳音！"))}})},init:function(){IdleTalk.editor=Util.newVditor({id:"messageContent",cache:!0,preview:{mode:"editor"},resize:{enable:!0,position:"top"},height:200,placeholder:"私信内容（最长20480个字）"});var e=IdleTalk.getUrlPath("toUser");!1!==e&&($("#sendMessageWindow").is(":hidden")&&($("#title").css("padding","230px 0 20px 0"),$("#sendMessageWindow").fadeIn(200)),$("#userForm").val(e)),$("#userForm").on("input",function(){$("#chatUsernameSelectedPanel").html(""),$("#chatUsernameSelectedPanel").show();var n=Util.getAtUsers($("#userForm").val());if(0===n.length||""===$("#userForm").val())$("#chatUsernameSelectedPanel").hide();else for(let e=0;e<n.length;e++){var t=n[e];$("#chatUsernameSelectedPanel").append("<a onclick=\"IdleTalk.fillUsername('"+t.username+"')\"><img src='"+t.avatar+"' style='height:20px;width:20px;'> "+t.username+"</a>")}})},getContent:function(){return IdleTalk.editor.getValue()},expand:function(){$("#sendMessageWindow").is(":hidden")?($("#title").css("padding","230px 0 20px 0"),$("#sendMessageWindow").fadeIn(200)):($("#title").css("padding","20px 0 20px 0"),$("#sendMessageWindow").fadeOut(200))},getUrlPath:function(e){for(var n=window.location.search.substring(1).split("&"),t=0;t<n.length;t++){var s=n[t].split("=");if(s[0]==e)return s[1]}return!1},fillUsername:function(e){$("#userForm").val(e),$("#chatUsernameSelectedPanel").html(""),$("#chatUsernameSelectedPanel").hide()}};$(document).ready(function(){IdleTalk.init()});