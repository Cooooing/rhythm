var ChatRoom={init:function(){if(0===$("#chatContent").length)return!1;ChatRoom.editor=Util.newVditor({id:"chatContent",cache:!0,preview:{mode:"editor"},resize:{enable:!0,position:"bottom"},toolbar:["emoji","headings","bold","italic","link","|","list","ordered-list","check","outdent","indent","|","quote","code","insert-before","insert-after","|","upload","table","|","undo","redo","|",{name:"more",toolbar:["fullscreen","edit-mode","both","preview","outline","content-theme","code-theme","devtools","info","help"]}],height:200,counter:4096,placeholder:"聊天室历史记录将永久保存，在发送消息前请三思而后行。",ctrlEnter:function(){ChatRoom.send()}});var t=null;$(".chat-room").on("dblclick",".vditor-reset img",function(){clearTimeout(t),$(this).hasClass("emoji")||window.open($(this).attr("src"))}).on("click",".vditor-reset img",function(e){var o,a;clearTimeout(t),$(this).hasClass("emoji")||(o=$(this),a=this,t=setTimeout(function(){var e=a.offsetTop,t=a.offsetLeft;$("body").append('<div class="img-preview" onclick="$(this).remove()"><img style="transform: translate3d('+Math.max(0,t)+"px, "+Math.max(0,e-$(window).scrollTop())+'px, 0)" src="'+o.attr("src").split("?imageView2")[0]+'"></div>'),$(".img-preview").css({"background-color":"#fff",position:"fixed"})},100))})},send:function(){var e=ChatRoom.editor.getValue();$.ajax({url:Label.servePath+"/chat-room/send",type:"POST",cache:!1,data:JSON.stringify({content:e}),beforeSend:function(){$(".form button.red").attr("disabled","disabled").css("opacity","0.3")},success:function(e){0===e.code?($("#chatContentTip").removeClass("error succ").html(""),ChatRoom.editor.setValue("")):$("#chatContentTip").addClass("error").html("<ul><li>"+e.msg+"</li></ul>")},error:function(e){$("#chatContentTip").addClass("error").html("<ul><li>"+e.statusText+"</li></ul>")},complete:function(e,t){$(".form button.red").removeAttr("disabled").css("opacity","1")}})},more:function(){page++,$.ajax({url:Label.servePath+"/chat-room/more?page="+page,type:"GET",cache:!1,success:function(e){if(0!==e.data.length)for(var t in e.data){t=e.data[t],t='<li class="fn-none"><div class="fn-flex">'+('<a rel="nofollow" href="/member/'+t.userName+'"><div class="avatar tooltipped tooltipped-se" aria-label="'+t.userName+'" style="background-image:url('+t.userAvatarURL+')"></div></a>')+'<div class="fn-flex-1"><div class="ft-smaller">'+('<a rel="nofollow" href="/member/'+t.userName+'"><span class="ft-gray">'+t.userName+'</span></a> <span class="ft-fade"> • '+t.time+"</span>")+'</div><div class="vditor-reset comment'+chatRoomPictureStatus+'">'+t.content+"</div></div></div></li>";$(".list ul li:last").after(t),$(".list li:last").slideDown(200)}else $("#more").removeAttr("onclick"),$("#more").html("已经到底啦！")}})}};